<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:sec="http://www.springframework.org/security/tags"
      xmlns:f="http://java.sun.com/jsf/core"
>

<ui:composition template="/layout.xhtml">

    <!--TODO UPDATE AS PER EX-->
    <ui:define name="title">
        EXAM
    </ui:define>

    <ui:define name="content">
        <h2>Used Books</h2>

        <sec:authenticated>
            <h:outputText value="Welcome to Used Books Corp #{userInfoController.fullNameOfCurrentUser}!"/>

            <!--TODO wat-->
            <h:form prependId="false" rendered="#{homeController.book.sellers.size() gt '0'}">
                <h4><h:outputLabel value="Title: #{homeController.book.title}"/></h4>
                <h:outputLabel value="Author(s):" />
                <ul>
                    <ui:repeat var="author" value="#{homeController.book.authors}" >
                        <li>
                            <h:outputLabel value="#{author}"/>
                        </li>
                    </ui:repeat>
                </ul>
                <h:outputLabel value="#{homeController.book.course}" />
                <h5>Sellers</h5>

                <!--TODO add check if seller name is user.-->
                <h:dataTable value="#{homeController.book.sellers}" var="seller" border="1" id="sellerTable">
                    <h:column>
                        <f:facet name="header">Seller</f:facet>
                        <h:outputLabel value="#{userInfoController.getFullNameByEmail(seller.email)}" class="sellerName"/>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Message</f:facet>
                        <h:inputTextarea value="#{messageController.messageForm[seller.email]}"
                                         id="checkBox_#{seller.email}"
                                         class="messageTo_#{seller.email}" />
                    </h:column>

                    <h:column>
                        <f:facet name="header">Send Message</f:facet>
                        <h:commandButton value="Send Message!" id="sendBtnId" action="#{messageController.sendMessage(seller.email)}"/>
                    </h:column>
                </h:dataTable>
            </h:form>



            <h:form prependId="false" rendered="#{homeController.book.sellers.size() eq  0}">
                <h3>No books for sale.</h3>
            </h:form>
        </sec:authenticated>

        <sec:anonymous>
            <p>You are not logged in!</p>
        </sec:anonymous>
    </ui:define>

</ui:composition>
</html>
